Create database four_a;
Use four_a;
CREATE TABLE BORROW( 
ROLL_NO INTEGER PRIMARY KEY, 
NAME VARCHAR(50), DATEOFISSUE DATE, 
NAMEOFBOOK VARCHAR(50), 
STATUS VARCHAR(50)); 

CREATE TABLE FINE( 
ROLL_NO INTEGER PRIMARY KEY, 
DATEOFRETURN DATE, 
AMT INTEGER); 

INSERT INTO BORROW VALUES(1, 'Anand', '2022-08-16', 'TOC', 'I'); 

INSERT INTO BORROW VALUES(2, 'Vaibhav', '2022-09-05', 'DS', 'I'); 

INSERT INTO BORROW VALUES(3, 'Avishkar', '2022-09-01', 'CNS', 'I'); 


INSERT INTO BORROW VALUES(4, 'Abrar', '2022-09-08', 'SPOS', 'I'); 
DELIMITER // 
CREATE PROCEDURE FINECALCULATION(IN RNO INT, BOOKNAME VARCHAR(20)) 
BEGIN 
DECLARE ISSUEDATE DATE; 
DECLARE DIFF INT; 
DECLARE FINE_AMT INT; 
DECLARE EXIT HANDLER FOR SQLEXCEPTION SELECT 'TABLE NOT FOUND'; 
SELECT DATEOFISSUE INTO ISSUEDATE FROM BORROW WHERE ROLL_NO=RNO AND NAMEOFBOOK=BOOKNAME; 
SELECT DATEDIFF(CURDATE(), ISSUEDATE) INTO DIFF; IF(DIFF>15 AND DIFF<30) THEN 
SET FINE_AMT = DIFF*5; 
INSERT INTO FINE VALUES(RNO, CURDATE(), FINE_AMT); 
ELSEIF(DIFF>30) THEN 
SET FINE_AMT = DIFF*50; 
INSERT INTO FINE VALUES(RNO, CURDATE(), FINE_AMT); 
ELSEIF(DIFF<15) THEN 
SET FINE_AMT = 0; 
INSERT INTO FINE VALUES(RNO, CURDATE(), FINE_AMT); 
END IF; 
UPDATE BORROW SET STATUS = 'R' WHERE ROLL_NO=RNO AND NAMEOFBOOK=BOOKNAME; 
END; 
//

DELIMITER ; 

CALL FINECALCULATION(3, 'CNS'); 

CALL FINECALCULATION(4, 'SPOS'); 

CALL FINECALCULATION(2, 'DS'); 

CALL FINECALCULATION(1, 'TOC'); 

SELECT * FROM FINE;

 
